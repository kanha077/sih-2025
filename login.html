<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <script type="module">
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";

        // Supabase project credentials (replace with your own)
        const SUPABASE_URL = "https://wraemxcqjycuddhfgjtt.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndyYWVteGNxanljdWRkaGZnanR0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNDc2MTYsImV4cCI6MjA3MjkyMzYxNn0.QyBb8idQcPmWJUQ7sMorfmnGp7fZU6DpuA1U79KpgCQ";
        const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Function to handle email/password login
        async function loginWithEmail(event) {
            event.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('message');

            messageDiv.textContent = '';
            messageDiv.classList.add('hidden');

            const { error } = await supabase.auth.signInWithPassword({ email, password });

            if (error) {
                messageDiv.textContent = 'Login failed: ' + error.message;
                messageDiv.classList.remove('hidden');
                messageDiv.classList.add('bg-red-100', 'text-red-700');
                console.error('Login failed:', error.message);
            } else {
                window.location.href = '/user.html'; // Redirect to user.html
            }
        }

        // Function to handle Google authentication
        async function signInWithGoogle() {
            const { error } = await supabase.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    redirectTo: `${window.location.origin}/user.html` // Redirect to user.html
                }
            });

            if (error) {
                messageDiv.textContent = 'Google login failed: ' + error.message;
                messageDiv.classList.remove('hidden');
                messageDiv.classList.add('bg-red-100', 'text-red-700');
                console.error('Google login failed:', error.message);
            }
        }

        // Expose functions to global scope
        window.loginWithEmail = loginWithEmail;
        window.signInWithGoogle = signInWithGoogle;
    </script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-sm">
        <h2 class="text-2xl font-bold text-gray-800 text-center mb-6">Login to Your Account</h2>
        
        <form id="login-form" onsubmit="loginWithEmail(event)">
            <label for="email" class="block text-sm font-medium text-gray-700">Email Address</label>
            <input type="email" id="email" name="email" placeholder="Enter your email" required 
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            
            <label for="password" class="block text-sm font-medium text-gray-700 mt-4">Password</label>
            <input type="password" id="password" name="password" placeholder="Enter your password" required 
                   class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">

            <div class="flex justify-end mt-2">
                <a href="/forgot_password.html" class="text-sm font-medium text-blue-500 hover:text-blue-600">Forgot password?</a>
            </div>

            <button type="submit"
                    class="mt-4 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-500 hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                Login
            </button>
        </form>

        <div id="message" role="alert" class="mt-4 p-3 text-sm rounded-lg hidden"></div>

        <div class="relative flex py-5 items-center">
            <div class="flex-grow border-t border-gray-400"></div>
            <span class="flex-shrink mx-4 text-gray-400 text-sm">OR</span>
            <div class="flex-grow border-t border-gray-400"></div>
        </div>

        <button onclick="signInWithGoogle()"
                class="w-full flex justify-center items-center py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
            <svg class="h-5 w-5 mr-2" aria-hidden="true" fill="currentColor" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                <path d="M44.5,20H24v8.5h11.8C34.7,31.7,32.6,35,28.8,37.2c-3.2,1.8-7.2,2.8-11.2,2.8c-10.2,0-18.7-8.5-18.7-18.7S7.4,2,17.7,2c5.2,0,9.7,2.1,13.1,5.5l6-6C33.1,1,28,0,22.7,0C12,0,3,9,3,19.7S12,39.4,22.7,39.4c9.1,0,16.5-5.9,19.2-14.7H44.5L44.5,20z" fill="#4285f4"></path>
                <path d="M22.7,39.4c-5.1,0-9.8-2-13.3-5.3l-5.6,5.1C8,44,15,47.4,22.7,47.4c10.7,0,19.7-9,19.7-19.7H22.7z" fill="#34a853"></path>
                <path d="M5.4,19.7c0-2.9,0.7-5.8,1.9-8.4l-5.8-4.5C0.3,10.6,0,14.9,0,19.7s0.3,9.1,1.5,13.2l5.8-4.5C6.1,25.5,5.4,22.6,5.4,19.7z" fill="#fbbc05"></path>
                <path d="M22.7,0C15,0,8,3.4,2.4,8.6l5.6,5.1c3.5-3.3,8.2-5.3,13.3-5.3c3.8,0,7.2,1.4,9.8,3.7l5.9-5.7C39.2,2.3,31.5,0,22.7,0z" fill="#ea4335"></path>
            </svg>
            Sign in with Google
        </button>
    </div>
</body>
</html>

<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f4f6f9;padding:40px}
    .wrap{max-width:900px;margin:0 auto;background:#fff;padding:24px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.06)}
    button{padding:10px 14px;border-radius:8px;border:0;background:#d33;color:#fff;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Dashboard</h1>
    <div id="info">Loading user...</div>
    <div style="margin-top:16px"><button id="logout">Log out</button></div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = 'YOUR_SUPABASE_URL';
  const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
  const { createClient } = supabase;
  const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function load() {
    // get authenticated user (server-validated)
    const { data: { user }, error: userErr } = await supabaseClient.auth.getUser();
    if (userErr || !user) {
      // not logged in -> redirect to login
      window.location.href = 'login.html';
      return;
    }

    // fetch profile
    const { data: profile, error: profileErr } = await supabaseClient
      .from('profiles')
      .select('*')
      .eq('id', user.id)
      .maybeSingle();

    const infoEl = document.getElementById('info');
    if (profileErr) {
      infoEl.innerText = `Logged in as ${user.email} (error loading profile: ${profileErr.message})`;
    } else if (profile) {
      infoEl.innerHTML = `<strong>Welcome, ${profile.full_name || profile.username || user.email}</strong>
                          <div>Username: ${profile.username || '(none)'}</div>
                          <div>Email: ${user.email}</div>`;
    } else {
      infoEl.innerHTML = `<strong>Welcome ${user.email}</strong><div>No profile found.</div>`;
    }
  }

  document.getElementById('logout').addEventListener('click', async () => {
    await supabaseClient.auth.signOut();
    window.location.href = 'login.html';
  });

  load();
</script>
</body>
</html>
